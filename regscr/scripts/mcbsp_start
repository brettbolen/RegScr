#!/usr/bin/regscr
#################
#  Set McBSP to drive SCLK and LRCLR
#
#################

PRINT "Start_McBSP_CLOCKS"

### Turn off SRG
##    SRGR.b25  FREE  = 1, free running clk
##    SRGR.b23  FRST  = 0, Frame-sync in reset   
##    SRGR.b22  GRST  = 0, SRG in reset
##    SRGR.b5/4 RINTM = 3, unchanged
##    SRGR.b0   RRST  = 1, enable receiver
#                            01234567
READ  DM365_MCBSP MB_spcr  ""
WRITE DM365_MCBSP MB_spcr  0x02000030   "turn_off_SRG"


### Set Frame and Word length
##    SRGR.b31    GSYNC  = 0  - 
##    SRGR.b29    CLKSM  = 0  - CLKS/CLKR
##    SRGR.b28    FSGM   = 1  - CLKS/CLKR
##    SRGR.b27-16 FPER   = 31 - Frame period = 32 bits per frame  // 64?
##    SRGR.b15-8  FWID   = 15 - Frame width  = 16 bits per word
##    SRGR.b7-0   CLKGDV = 3  - CLKG Divider = 4  ( 12.288 MHZ / 4 = 3.072Mhz)
##                           01234567
WRITE DM365_MCBSP MB_srgr  0x101f0f07    "Set_Framing"

### tickle clock : PCR - toggle clock 
## Set Pins
##    PCR.b11 FSXM   = 0 - Transmit Frame sync mod bit,
##    PCR.b10 FSRM   = 1 - Recieve Frame sync mod bit, drive 
##    PCR.b9  CLKXM  = 0 - Transmit Bit Clock
##    PCR.b8  CLKRM  = 1 - Recieve Bit clock, drive 
##    PCR.b7  SCLKME = 0 - Transmit Frame sync mod bit, drive 
##    PCR.b3  FSXP   = 0 - TX Frame clock polarity
##    PCR.b2  FSRP   = 0 - RX Frame clock polarity
##    PCR.b1  CLKXP  = 0 - TX Bit clock polarity
##    PCR.b0  CLKRP  = 0,1 - RX Bit clock polarity
WRITE DM365_MCBSP MB_pcr  0x00000500   "Toggle_RX_CLK"
WRITE DM365_MCBSP MB_pcr  0x00000501   ""

### Turn off SRG
##    SRGR.b25  FREE  = 1, free running clk
##    SRGR.b23  FRST  = 1, Frame-sync in reset   
##    SRGR.b22  GRST  = 1, SRG in reset
##    SRGR.b5/4 RINTM = 3, unchanged
##    SRGR.b0   RRST  = 1, enable receiver
#                            01234567
WRITE DM365_MCBSP MB_spcr  0x02C00031   "Start_SRG"


### tickle clock : PCR - toggle clock 
## Set Pins
##    PCR.b11 FSXM   = 0 - Transmit Frame sync mod bit,
##    PCR.b10 FSRM   = 1 - Recieve Frame sync mod bit, drive 
##    PCR.b9  CLKXM  = 0 - Transmit Bit Clock
##    PCR.b8  CLKRM  = 1 - Recieve Bit clock, drive 
##    PCR.b7  SCLKME = 0 - Transmit Frame sync mod bit, drive 
##    PCR.b3  FSXP   = 0 - TX Frame clock polarity
##    PCR.b2  FSRP   = 0 - RX Frame clock polarity
##    PCR.b1  CLKXP  = 0 - TX Bit clock polarity
##    PCR.b0  CLKRP  = 0,1 - RX Bit clock polarity
WRITE DM365_MCBSP MB_pcr  0x00000500   "Toggle_RX_CLK"
WRITE DM365_MCBSP MB_pcr  0x00000501   ""



PRINT "..fin"
